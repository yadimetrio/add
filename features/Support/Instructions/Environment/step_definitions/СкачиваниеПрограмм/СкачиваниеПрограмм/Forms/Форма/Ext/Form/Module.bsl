&НаКлиенте
Перем СчетчикТаймера,МаксСчетчиктаймера;

//начало текста модуля
&НаКлиенте
Перем Ванесса;

&НаКлиенте
Функция ПолучитьСписокТестов(КонтекстФреймворкаBDD) Экспорт
	Ванесса = КонтекстФреймворкаBDD;
	ЮнитТестированиеИмя = КонтекстФреймворкаBDD.МетаданныеИмя();
	ВсеТесты = Новый Массив;

	// описание шагов
	//пример вызова Ванесса.ДобавитьШагВМассивТестов(ВсеТесты,Снипет,ИмяПроцедуры,ПредставлениеТеста,Транзакция,Параметр);

	Ванесса.ДобавитьШагВМассивТестов(ВсеТесты,"ЯОткрылВБраузереСайт(Парам01Строка)","ЯОткрылВБраузереСайт","Я открыл в браузере сайт ""https://www.sourcetreeapp.com/""");
	Ванесса.ДобавитьШагВМассивТестов(ВсеТесты,"ЯНажалНаКнопкуDownloadНаСайтеSourcetree()","ЯНажалНаКнопкуDownloadНаСайтеSourcetree","Я нажал на кнопку Download на сайте sourcetree");
	Ванесса.ДобавитьШагВМассивТестов(ВсеТесты,"ЯНажалНаКнопкуDownloadНаСайтеGit()","ЯНажалНаКнопкуDownloadНаСайтеGit","Я нажал на кнопку Download на сайте git");
	Ванесса.ДобавитьШагВМассивТестов(ВсеТесты,"ЯНажимаюНаКнопкуDownloadPython3x()","ЯНажимаюНаКнопкуDownloadPython3x","Я нажимаю на кнопку Download Python 3x");
	Ванесса.ДобавитьШагВМассивТестов(ВсеТесты,"ЯНажимаюНаКнопкуСохранить()","ЯНажимаюНаКнопкуСохранить","Я нажимаю на кнопку Сохранить");

	Возврат ВсеТесты;
КонецФункции

&НаКлиенте
Процедура ПередНачаломСценария() Экспорт
	Если НЕ БраузерПринудительноЗакрывался Тогда
		БраузерПринудительноЗакрывался = Истина;
		СтрокаКоманды = "TASKKILL /F /IM chrome.exe";
		КомандаСистемы(СтрокаКоманды);

		ОткрытьСайт("https://github.com/vanessa-opensource/add");

		Попытка
			Оболочка = Новый COMОбъект("Shell.Application");
			Оболочка.MinimizeAll();
		Исключение
			ВызватьИсключение "Не удалось подключить COM объект <Shell.Application>";
		КонецПопытки;

	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ПередОкончаниемСценария() Экспорт

КонецПроцедуры


&НаКлиенте
Процедура УдалитьСкаченныеФайлыПоМаске(Маска)
	WSH         = Новый COMobject("wscript.shell");
	USERPROFILE = WSH.ExpandEnvironmentStrings("%USERPROFILE%");

	ГдеИскать = USERPROFILE + "\Downloads";

	Файлы = НайтиФайлы(ГдеИскать,Маска,Ложь);
	Для каждого Файл Из Файлы Цикл
		Сообщить("Удаляю файл: " + Файл.ПолноеИмя);
		УдалитьФайлы(Файл.ПолноеИмя);
	КонецЦикла;
КонецПроцедуры

&НаКлиенте
Процедура ТаймерОжидания()
	ОтключитьОбработчикОжидания("ТаймерОжидания");
	Ванесса.ПродолжитьВыполнениеШагов();
КонецПроцедуры

&НаКлиенте
Процедура ТаймерОжиданияSource()
	СчетчикТаймера = СчетчикТаймера + 1;
	Если СчетчикТаймера >= МаксСчетчиктаймера Тогда
		ОтключитьОбработчикОжидания("ТаймерОжиданияSource");
		Ванесса.ПродолжитьВыполнениеШагов();
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ОткрытьСайт(Адрес)
	Стр = """C:\Program Files (x86)\Google\Chrome\Application\chrome.exe"" """ + Адрес + """ -start-maximized";
	ЗапуститьПриложение(Стр);
КонецПроцедуры



&НаСервере
Процедура ПроверитьИстину()
	юТест = ВнешниеОбработки.Создать(ЮнитТестированиеИмя);
	юТест.Проверить(Истина, "Ошибка проверки");
КонецПроцедуры


&НаКлиенте
//Я открыл в браузере сайт "https://www.sourcetreeapp.com/"
//@ЯОткрылВБраузереСайт(Парам01Строка)
Процедура ЯОткрылВБраузереСайт(АдресСайта) Экспорт
	ПроверитьИстину();
	ОткрытьСайт(АдресСайта);

	Ванесса.ЗапретитьВыполнениеШагов();
	ПодключитьОбработчикОжидания("ТаймерОжидания",2);

КонецПроцедуры

&НаКлиенте
Функция ПолучитьСтрокуВызоваSikuli()
	Возврат """C:\Program Files (x86)\Java\jre6\bin\java.exe"" -Xms64M -Xmx512M -Dfile.encoding=UTF-8 -Dpython.path=""C:\Program Files (x86)\Sikuli X\sikuli-script.jar/"" -jar ""C:\Program Files (x86)\Sikuli X\sikuli-ide.jar"" -r ";
КонецФункции

&НаКлиенте
//Я нажал на кнопку Download на сайте sourcetree
//@ЯНажалНаКнопкуDownloadНаСайтеSourcetree()
Процедура ЯНажалНаКнопкуDownloadНаСайтеSourcetree() Экспорт
	УдалитьСкаченныеФайлыПоМаске("SourceTreeSetup*.exe");

	Команда = ПолучитьСтрокуВызоваSikuli() + Ванесса.Объект.КаталогИнструментов + "\tools\Sikuli\SourceTree.sikuli";
	Рез = Ванесса.ВыполнитьКомандуОСБезПоказаЧерногоОкна(Команда);
	Ванесса.ПроверитьРавенство(Рез,0,"Был клик на кнопку большую синюю кнопку ""Скачать"".");


	Ванесса.ЗапретитьВыполнениеШагов();
	ПодключитьОбработчикОжидания("ТаймерОжидания",3);
КонецПроцедуры

&НаКлиенте
//Я нажал на кнопку Download на сайте git
//@ЯНажалНаКнопкуDownloadНаСайтеGit()
Процедура ЯНажалНаКнопкуDownloadНаСайтеGit() Экспорт
	УдалитьСкаченныеФайлыПоМаске("GIT*.exe");

	Команда = ПолучитьСтрокуВызоваSikuli() + Ванесса.Объект.КаталогИнструментов + "\tools\Sikuli\Git.sikuli";
	Рез = Ванесса.ВыполнитьКомандуОСБезПоказаЧерногоОкна(Команда);
	Ванесса.ПроверитьРавенство(Рез,0,"Был клик на кнопку ""Скачать"".");

	Ванесса.ЗапретитьВыполнениеШагов();
	ПодключитьОбработчикОжидания("ТаймерОжидания",3);
КонецПроцедуры

&НаКлиенте
//Я нажимаю на кнопку Сохранить
//@ЯНажимаюНаКнопкуСохранить()
Процедура ЯНажимаюНаКнопкуСохранить() Экспорт

	Команда = ПолучитьСтрокуВызоваSikuli() + Ванесса.Объект.КаталогИнструментов + "\tools\Sikuli\ClickSaveFF.sikuli";
	Рез = Ванесса.ВыполнитьКомандуОСБезПоказаЧерногоОкна(Команда);
	Ванесса.ПроверитьРавенство(Рез,0,"Был клик на кнопку ""Сохранить"" firefox.");

	Ванесса.ЗапретитьВыполнениеШагов();
	ПодключитьОбработчикОжидания("ТаймерОжидания",2);
КонецПроцедуры


&НаКлиенте
//Я нажимаю на кнопку Download Python 3x
//@ЯНажимаюНаКнопкуDownloadPython3x()
Процедура ЯНажимаюНаКнопкуDownloadPython3x() Экспорт
	УдалитьСкаченныеФайлыПоМаске("python*.exe");

	Команда = ПолучитьСтрокуВызоваSikuli() + Ванесса.Объект.КаталогИнструментов + "\tools\Sikuli\Python.sikuli";
	Рез = Ванесса.ВыполнитьКомандуОСБезПоказаЧерногоОкна(Команда);
	Ванесса.ПроверитьРавенство(Рез,0,"Был клик на кнопку ""Скачать"".");

	Ванесса.ЗапретитьВыполнениеШагов();
	ПодключитьОбработчикОжидания("ТаймерОжидания",3);
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)

	ПодключитьОбработчикОжидания("ОжиданиеЗапускТеста", 1, Истина);

КонецПроцедуры

&НаКлиенте
Процедура ОжиданиеЗапускТеста()


	ФормуНашли = Ложь;
	ФормаVanessa = Неопределено;

	Окна = ПолучитьОкна();
	Для каждого Окн Из Окна Цикл
		Если ТипЗнч(Окн) = Тип("ОкноКлиентскогоПриложения") Тогда
			Если Найти(Строка(Окн.Заголовок), "Vanessa-ADD")>0 Тогда
				ФормуНашли = Истина;
				Сообщить("" + Окн.Заголовок);
				ФормаVanessa = Окн.ПолучитьСодержимое();
			КонецЕсли;
		КонецЕсли;

	КонецЦикла;

	Если ФормуНашли Тогда

		ФормаVanessa.ДобавитьВнешнийСписокПроцедур(ПолучитьСписокТестов(ФормаVanessa), ЭтаФорма.УникальныйИдентификатор, ЭтаФорма);
		Сообщить("Подключились можно отлаживать");

	КонецЕсли;

КонецПроцедуры

//окончание текста модуля